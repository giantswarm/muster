name: "workflow-execution-get-with-steps"
category: "behavioral"
concept: "workflow"
tags: ["workflow", "execution", "get", "steps"]
timeout: "3m"

steps:
- id: "create-steps-workflow"
  tool: "core_workflow_create"
  args:
    name: "steps-test-workflow"
    inputSchema:
      type: "object"
      properties:
        service_name:
          type: "string"
          default: "test-service"
      required: []
    steps:
      - id: "first_step"
        tool: "core_service_list"
        store: "services_data"
      - id: "second_step"
        tool: "core_workflow_list"
        store: "workflows_data"
      - id: "third_step"
        tool: "core_config_get"
        store: "config_data"
  expected:
    success: true
  cleanup:
    - tool: "core_workflow_delete"
      args: { name: "steps-test-workflow" }

- id: "execute-steps-workflow"
  tool: "workflow_steps-test-workflow"
  args:
    service_name: "steps-service"
  expected:
    success: true
  store: "steps_execution"

- id: "get-execution-with-steps-explicit"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["steps", "first_step", "second_step", "third_step"]

- id: "verify-all-step-details"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["step_id", "tool", "status", "started_at", "completed_at", "duration_ms", "input", "result", "stored_as"]

- id: "verify-step-storage-info"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["services_data", "workflows_data", "config_data"]

- id: "verify-step-tool-mapping"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["core_service_list", "core_workflow_list", "core_config_get"]

- id: "verify-step-execution-order"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["first_step", "second_step", "third_step"]

- id: "verify-step-status"
  tool: "core_workflow_execution_get"
  args:
    execution_id: "{{ steps_execution.execution_id }}"
    include_steps: true
  expected:
    success: true
    contains: ["completed"]

cleanup:
- tool: "core_workflow_delete"
  args: { name: "steps-test-workflow" } 
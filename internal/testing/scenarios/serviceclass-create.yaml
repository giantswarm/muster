name: "serviceclass-create"
description: "Test creating a basic ServiceClass"
category: "behavioral"
concept: "serviceclass"
tags: ["serviceclass", "create", "core-api"]
timeout: "1m"

pre_configuration:
  mcp_servers:
    - name: "test-mock"
      config:
        tools:
          - name: "serviceconnection_start"
            input_schema:
              args:
                port:
                  type: "string"
                  default: "18000"
            responses:
              - response:
                  status: "started"
                  sessionID: "mock-session-12345"

          - name: "serviceconnection_stop"
            input_schema:
              args:
                sessionID:
                  type: "string"
              required:
                - sessionID
            responses:
              - response:
                  status: "stopped"

steps:
- id: "create-basic-serviceclass"
  description: "Create a basic ServiceClass with lifecycle tools"
  tool: "core_serviceclass_create"
  args:
    name: "basic-create-sc"
    version: "1.0.0"
    args:
      port:
        type: "string"
        description: "local port for serviceconnection"
        required: true
    serviceConfig:
      lifecycleTools:
        start:
          tool: "x_test-mock_serviceconnection_start"
          args:
            port: "{{.port}}"
        stop:
          tool: "x_test-mock_serviceconnection_stop"
          args:
            sessionID: "{{.start.sessionID}}"
      outputs:
        sessionID: "{{.start.sessionID}}"
        url: "http://localhost:{{.port}}"
  expected:
    success: true

- id: "test-serviceconnection"
  description: "Test the serviceconnection"
  tool: "core_service_create"
  args:
    serviceClassName: "basic-create-sc"
    args:
      port: "18001"    
  expected:
    success: true
    json_path:
      "outputs.sessionID": "mock-session-12345"
      "outputs.url": "http://localhost:18001"

cleanup:
- id: "delete-created-serviceclass"
  description: "Delete the test ServiceClass"
  tool: "core_serviceclass_delete"
  args:
    name: "basic-create-sc"
  expected:
    success: true 